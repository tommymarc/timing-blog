<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>vue+element-ui中的图片获取与上传 | Timing官方博客</title>
    <meta name="generator" content="VuePress 1.5.2">
    
    <meta name="description" content="
请求图片

请求图片的时候，带上{ responseType: 'blob' }, 否则图片显示的可能是乱码。

axios
  .post(url, parmas, { responseType: 'blob' })
  .then(res => {
    return Promise.resolve(res);
  })
  .catch(e => {
    re ...">
    <link rel="preload" href="/timing-blog/assets/css/0.styles.17ad50ee.css" as="style"><link rel="preload" href="/timing-blog/assets/js/app.0e5bd67b.js" as="script"><link rel="preload" href="/timing-blog/assets/js/10.7a656b3b.js" as="script"><link rel="preload" href="/timing-blog/assets/js/12.0f90fce1.js" as="script"><link rel="preload" href="/timing-blog/assets/js/31.81328e1c.js" as="script"><link rel="prefetch" href="/timing-blog/assets/js/11.2604c7dc.js"><link rel="prefetch" href="/timing-blog/assets/js/13.e96bc18b.js"><link rel="prefetch" href="/timing-blog/assets/js/14.a94cd1c2.js"><link rel="prefetch" href="/timing-blog/assets/js/15.2e4b1edd.js"><link rel="prefetch" href="/timing-blog/assets/js/16.63879fd6.js"><link rel="prefetch" href="/timing-blog/assets/js/17.4aa33424.js"><link rel="prefetch" href="/timing-blog/assets/js/18.25fd9ee4.js"><link rel="prefetch" href="/timing-blog/assets/js/19.7da3cba7.js"><link rel="prefetch" href="/timing-blog/assets/js/20.6beb50c8.js"><link rel="prefetch" href="/timing-blog/assets/js/21.276c79d5.js"><link rel="prefetch" href="/timing-blog/assets/js/22.532a7f03.js"><link rel="prefetch" href="/timing-blog/assets/js/23.6f7c2ae2.js"><link rel="prefetch" href="/timing-blog/assets/js/24.df45f5ba.js"><link rel="prefetch" href="/timing-blog/assets/js/25.eea4fa34.js"><link rel="prefetch" href="/timing-blog/assets/js/26.d7e8f7c3.js"><link rel="prefetch" href="/timing-blog/assets/js/27.4efbd872.js"><link rel="prefetch" href="/timing-blog/assets/js/28.fd14ef27.js"><link rel="prefetch" href="/timing-blog/assets/js/29.32becfd1.js"><link rel="prefetch" href="/timing-blog/assets/js/3.1f6e3886.js"><link rel="prefetch" href="/timing-blog/assets/js/30.d5989f40.js"><link rel="prefetch" href="/timing-blog/assets/js/32.a9640142.js"><link rel="prefetch" href="/timing-blog/assets/js/33.7c906d0e.js"><link rel="prefetch" href="/timing-blog/assets/js/34.3240a888.js"><link rel="prefetch" href="/timing-blog/assets/js/35.0a22d3f3.js"><link rel="prefetch" href="/timing-blog/assets/js/36.e36c0b27.js"><link rel="prefetch" href="/timing-blog/assets/js/37.319626df.js"><link rel="prefetch" href="/timing-blog/assets/js/38.8ccd773f.js"><link rel="prefetch" href="/timing-blog/assets/js/39.f8af013d.js"><link rel="prefetch" href="/timing-blog/assets/js/4.522c8d74.js"><link rel="prefetch" href="/timing-blog/assets/js/5.b6530c6b.js"><link rel="prefetch" href="/timing-blog/assets/js/6.33999351.js"><link rel="prefetch" href="/timing-blog/assets/js/7.ed13bdfe.js"><link rel="prefetch" href="/timing-blog/assets/js/8.19ee6a11.js"><link rel="prefetch" href="/timing-blog/assets/js/9.fdb81868.js"><link rel="prefetch" href="/timing-blog/assets/js/vuejs-paginate.dc1262e9.js">
    <link rel="stylesheet" href="/timing-blog/assets/css/0.styles.17ad50ee.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div id="vuepress-theme-blog__global-layout"><section id="header-wrapper"><header id="header"><div class="header-wrapper"><div class="title"><a href="/timing-blog/" class="nav-link home-link"><img src="data:image/png;base64,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" alt="Timing" class="logo-img"> <h1 class="sidebar-title">Timing官方博客</h1></a></div> <div class="header-right-wrap"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div></div></div></header></section> <div id="mobile-header"><div class="mobile-header-bar"><div class="mobile-header-title"><a href="/timing-blog/" class="nav-link mobile-home-link">Timing官方博客 </a> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"><line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line></svg></div> <div class="mobile-menu-wrapper"><hr class="menu-divider"> <ul class="mobile-nav"><li class="mobile-nav-item"><a href="/timing-blog/" class="nav-link">Timing</a></li><li class="mobile-nav-item"><a href="/timing-blog/Ios/" class="nav-link">Ios</a></li><li class="mobile-nav-item"><a href="/timing-blog/Web/" class="nav-link">Web</a></li><li class="mobile-nav-item"><a href="/timing-blog/videoCard/" class="nav-link">videoCategroy</a></li><li class="mobile-nav-item"><a href="/timing-blog/links.html" class="nav-link">TimingMan</a></li> <li class="mobile-nav-item"><!----></li></ul></div></div></div> <div class="content-wrapper"><div class="side-bar"><div class="menu"><a href="/timing-blog/" class="nav-link menu-item"><i class="iconfont icon-timing"></i>TIMING
    </a> <div><a href="/timing-blog/department/web/" class="menu-item"><i class="iconfont icon-web"></i>web
      </a></div> <a href="/timing-blog/videoCard.html" class="nav-link menu-item"><i class="iconfont icon-ai-video"></i>Video
    </a> <a href="/timing-blog/links.html" class="nav-link menu-item"><i class="iconfont icon-yonghu"></i>T-Guy
    </a></div></div> <div id="vuepress-theme-blog__post-layout"><article itemscope="itemscope" itemtype="https://schema.org/BlogPosting" class="vuepress-blog-theme-content"><header><h1 itemprop="name headline" class="post-title">
        vue+element-ui中的图片获取与上传
      </h1></header> <div itemprop="articleBody" class="content__default"><h1 id="vue-element-ui中的图片获取与上传"><a href="#vue-element-ui中的图片获取与上传" class="header-anchor">#</a> vue+element-ui中的图片获取与上传</h1> <h2 id="请求图片"><a href="#请求图片" class="header-anchor">#</a> 请求图片</h2> <p>请求图片的时候，带上<code>{ responseType: 'blob' }</code>, 否则图片显示的可能是乱码。</p> <div class="language-js extra-class"><pre class="language-js"><code>axios
  <span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> parmas<span class="token punctuation">,</span> <span class="token punctuation">{</span> responseType<span class="token operator">:</span> <span class="token string">'blob'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">e</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> Promise<span class="token punctuation">.</span><span class="token function">reject</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="显示图片"><a href="#显示图片" class="header-anchor">#</a> 显示图片</h2> <p>图片返回的是文件流的形式, 控制台中显示的是乱码。
直接显示二进制图片会出错，所以我们要进行处理。</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token comment">&lt;!-- template中 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">alt</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>logo<span class="token punctuation">&quot;</span></span> <span class="token attr-name">:src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>imageUrl<span class="token punctuation">&quot;</span></span> <span class="token attr-name">@error</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>handleLoadError<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">/*------ script中------*/</span>
<span class="token keyword">let</span> urlCreator <span class="token operator">=</span> window<span class="token punctuation">.</span><span class="token constant">URL</span> <span class="token operator">||</span> window<span class="token punctuation">.</span>webkitURL<span class="token punctuation">;</span>
<span class="token keyword">let</span> imageUrl <span class="token operator">=</span> urlCreator<span class="token punctuation">.</span><span class="token function">createObjectURL</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>imageUrl <span class="token operator">=</span> imageUrl<span class="token punctuation">;</span>
</code></pre></div><p>显示图片中，要对万一图片显示不出来的情况进行处理。使用onerror事件可以对加载图片失败的情况进行处理。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">handleLoadError</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> img <span class="token operator">=</span> e<span class="token punctuation">.</span>srcElement<span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>imageUrl <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>errorLoadImg<span class="token punctuation">;</span>  <span class="token comment">//  用加载失败的图片替代之</span>
  img<span class="token punctuation">.</span>onerror <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span> <span class="token comment">//  清除错误:如果错误时加载时显示的图片出错，将会一直循环，所以我们必须清除掉错误，限制运行一次</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="上传图片-使用-element-ui-的-el-upload"><a href="#上传图片-使用-element-ui-的-el-upload" class="header-anchor">#</a> 上传图片:使用 element-ui 的 el-upload</h2> <h3 id="自动上传，一次传一张图片"><a href="#自动上传，一次传一张图片" class="header-anchor">#</a> 自动上传，一次传一张图片</h3> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-upload</span>
  <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>uploadUrl<span class="token punctuation">&quot;</span></span>
  <span class="token attr-name">:show-file-list</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>false<span class="token punctuation">&quot;</span></span>
  <span class="token attr-name">:accept</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span><span class="token punctuation">'</span>image/*'<span class="token punctuation">&quot;</span></span>
  <span class="token attr-name">:headers</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>{token:$cookieStorage.token}<span class="token punctuation">&quot;</span></span>
  <span class="token attr-name">:on-success</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>handleSuccess<span class="token punctuation">&quot;</span></span>
  <span class="token attr-name">:on-error</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>handleError<span class="token punctuation">&quot;</span></span>
  <span class="token attr-name">:before-upload</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>handleBeforeUpload<span class="token punctuation">&quot;</span></span>
  <span class="token attr-name">:on-progress</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>handleProgress<span class="token punctuation">&quot;</span></span>
<span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-button</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>primary<span class="token punctuation">&quot;</span></span> <span class="token attr-name">size</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>medium<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>上传图片<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-button</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-upload</span><span class="token punctuation">&gt;</span></span>
<span class="token comment">&lt;!--
  action: 图片上传的地址
  show-file-list: 是否显示文件上传列表
  accept: 可接受的上传类型，image/*为图片
  headers: 头部信息
  on-success: 上传成功事件
  on-error: 上传失败事件
  before-upload: 上传前处理事件，返回一个值，值为false将阻止上传
  on-progress: 上传中事件
  --&gt;</span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">/*----- 以下为常用处理代码 ------*/</span>
<span class="token function">handleSuccess</span><span class="token punctuation">(</span><span class="token parameter">response<span class="token punctuation">,</span> file<span class="token punctuation">,</span> fileList</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$success</span><span class="token punctuation">(</span><span class="token string">&quot;上传成功&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token function">handleError</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$error</span><span class="token punctuation">(</span><span class="token string">&quot;上传失败,请重新上传图片!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token function">handleBeforeUpload</span><span class="token punctuation">(</span><span class="token parameter">file</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> isImage <span class="token operator">=</span> file<span class="token punctuation">.</span>type<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span><span class="token string">&quot;image&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>isImage<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>$message<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&quot;上传文件类型必须是图片!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">const</span> isLt2M <span class="token operator">=</span> file<span class="token punctuation">.</span>size <span class="token operator">/</span> <span class="token number">1024</span> <span class="token operator">/</span> <span class="token number">1024</span> <span class="token operator">&lt;</span> <span class="token number">2</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>isLt2M<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>$message<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&quot;上传图片大小不能超过 2MB!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> isImage <span class="token operator">&amp;&amp;</span> isLt2M<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token function">handleProgress</span><span class="token punctuation">(</span><span class="token parameter">event<span class="token punctuation">,</span> file<span class="token punctuation">,</span> fileList</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>loading <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>  <span class="token comment">//  上传时执行loading事件</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="手动上传，一次提交多个-el-upload-的图片"><a href="#手动上传，一次提交多个-el-upload-的图片" class="header-anchor">#</a> 手动上传，一次提交多个 el-upload 的图片</h2> <p>:::tip
要求：每个 picture area 限制选择一张图片，点击确定后一起提交。
:::</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-upload</span>
  <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>myUrl<span class="token punctuation">&quot;</span></span>
  <span class="token attr-name">:on-change</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>(file,fileList)=&gt;{handleChange(file,fileList,1)}<span class="token punctuation">&quot;</span></span>
  <span class="token attr-name">:on-remove</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>(file,fileList)=&gt;{handleRemove(file,fileList,1)}<span class="token punctuation">&quot;</span></span>
  <span class="token attr-name">:auto-upload</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>false<span class="token punctuation">&quot;</span></span>
  <span class="token attr-name">:file-list</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>fileList[0]<span class="token punctuation">&quot;</span></span>
  <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>file1<span class="token punctuation">&quot;</span></span>
<span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-button</span> <span class="token attr-name">size</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>small<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>选择图片<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-button</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-upload</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-upload</span>
  <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>myUrl<span class="token punctuation">&quot;</span></span>
  <span class="token attr-name">:on-change</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>(file,fileList)=&gt;{handleChange(file,fileList,2)}<span class="token punctuation">&quot;</span></span>
  <span class="token attr-name">:on-remove</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>(file,fileList)=&gt;{handleRemove(file,fileList,2)}<span class="token punctuation">&quot;</span></span>
  <span class="token attr-name">:auto-upload</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>false<span class="token punctuation">&quot;</span></span>
  <span class="token attr-name">:file-list</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>fileList[1]<span class="token punctuation">&quot;</span></span>
  <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>file2<span class="token punctuation">&quot;</span></span>
<span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-button</span> <span class="token attr-name">size</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>small<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>选择图片<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-button</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-upload</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-upload</span>
  <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>myUrl<span class="token punctuation">&quot;</span></span>
  <span class="token attr-name">:on-change</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>(file,fileList)=&gt;{handleChange(file,fileList,3)}<span class="token punctuation">&quot;</span></span>
  <span class="token attr-name">:on-remove</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>(file,fileList)=&gt;{handleRemove(file,fileList,3)}<span class="token punctuation">&quot;</span></span>
  <span class="token attr-name">:auto-upload</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>false<span class="token punctuation">&quot;</span></span>
  <span class="token attr-name">:file-list</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>fileList[2]<span class="token punctuation">&quot;</span></span>
  <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>file3<span class="token punctuation">&quot;</span></span>
<span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-button</span> <span class="token attr-name">size</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>small<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>选择图片<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-button</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-upload</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-button</span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>submitData<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>确认<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-button</span><span class="token punctuation">&gt;</span></span>
<span class="token comment">&lt;!--
  action:提交的地址，此处随便写一个，不写会报错
  on-change: 图片上传到缓存中将被触发
  on-remove: 从缓存中删除文件将被触发
  --&gt;</span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
fileList<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">//缓存区文件</span>
uploadFile<span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token comment">//  上传用文件</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token function">handleChange</span><span class="token punctuation">(</span><span class="token parameter">file<span class="token punctuation">,</span> fileList<span class="token punctuation">,</span> type</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token comment">//  限制单张上传，超过限制即覆盖</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>fileList<span class="token punctuation">.</span>length <span class="token operator">&gt;</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  fileList<span class="token punctuation">.</span><span class="token function">splice</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">//  校验</span>
<span class="token keyword">const</span> isLt2M <span class="token operator">=</span> file<span class="token punctuation">.</span>size <span class="token operator">/</span> <span class="token number">1024</span> <span class="token operator">/</span> <span class="token number">1024</span> <span class="token operator">&lt;</span> <span class="token number">5</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>isLt2M<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>$message<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&quot;上传图片大小不能超过 5MB!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">removeUploadedFile</span><span class="token punctuation">(</span>type<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//  不符合要求删除文件</span>
  <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> isImage <span class="token operator">=</span> file<span class="token punctuation">.</span>raw<span class="token punctuation">.</span>type<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span><span class="token string">&quot;image&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>isImage<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>$message<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&quot;上传的格式必须是图片!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">removeUploadedFile</span><span class="token punctuation">(</span>type<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">//  验证通过之后，将缓存区文件存入上传区文件中</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>formData<span class="token punctuation">.</span>files<span class="token punctuation">[</span>type<span class="token punctuation">]</span> <span class="token operator">=</span> file<span class="token punctuation">.</span>raw<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token comment">//  从缓存区移除文件</span>
<span class="token function">removeUploadedFile</span><span class="token punctuation">(</span><span class="token parameter">type</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>type <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>$refs<span class="token punctuation">.</span>file1<span class="token punctuation">.</span><span class="token function">clearFiles</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>type <span class="token operator">===</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>$refs<span class="token punctuation">.</span>file2<span class="token punctuation">.</span><span class="token function">clearFiles</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>type <span class="token operator">===</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>$refs<span class="token punctuation">.</span>file3<span class="token punctuation">.</span><span class="token function">clearFiles</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">//  删除文件</span>
<span class="token function">handleRemove</span><span class="token punctuation">(</span><span class="token parameter">file<span class="token punctuation">,</span> fileList<span class="token punctuation">,</span> type</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token comment">//  删除文件时要移除缓存区文件和上传区文件</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>fileList<span class="token punctuation">[</span>type<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>uploadFile<span class="token punctuation">[</span>type<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token comment">//  上传文件</span>
<span class="token function">submitData</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token comment">//  校验是否选择文件</span>
<span class="token keyword">let</span> fileNum <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">flatten</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>uploadFile<span class="token punctuation">)</span><span class="token punctuation">.</span>length<span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>fileNum <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$error</span><span class="token punctuation">(</span><span class="token string">&quot;未选择任何文件!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">//  使用formdata格式</span>
<span class="token keyword">let</span> formData <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FormData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>formData<span class="token punctuation">.</span>files<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  formData<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">&quot;file1&quot;</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>formData<span class="token punctuation">.</span>files<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>formData<span class="token punctuation">.</span>files<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  formData<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">&quot;file2&quot;</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>formData<span class="token punctuation">.</span>files<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>formData<span class="token punctuation">.</span>files<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  formData<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">&quot;file2&quot;</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>formData<span class="token punctuation">.</span>files<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">//  请求:在headers上务必加上content-Type,指定表单形式发送</span>
axios
<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">&quot;uploadUrl&quot;</span><span class="token punctuation">,</span> formData<span class="token punctuation">,</span> <span class="token punctuation">{</span>headers<span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token string">&quot;Content-Type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;multipart/form-data&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$success</span><span class="token punctuation">(</span><span class="token string">&quot;上传图片成功!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>fileList <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>uploadFile <span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">e</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">//  扁平化数组</span>
<span class="token function">flatten</span><span class="token punctuation">(</span><span class="token parameter">arr</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token keyword">let</span> res <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> arr<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    res <span class="token operator">=</span> res<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">flatten</span><span class="token punctuation">(</span>arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    res<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">return</span> res<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><blockquote><p><a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Basics_of_HTTP/MIME_types#multipartform-data" target="_blank" rel="noopener noreferrer">multipartform-data相关知识<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></blockquote> <h2 id="图片加载技术：预加载和懒加载"><a href="#图片加载技术：预加载和懒加载" class="header-anchor">#</a> 图片加载技术：预加载和懒加载</h2> <ul><li>预加载：重点在&quot;预&quot;，在用户需要看到该图片之前，就已经加载和请求到该图片。</li> <li>懒加载: 重点在&quot;懒&quot;，尽可能少的加载图片，只加载必需的图片（用户屏幕可视范围内）,目的是尽可能的减少请求数，减缓服务器的压力。
在vue中懒加载的组件有很多，比如<code>vue-lazy-laod</code>和<code>vue-clazy-load</code></li></ul> <h2 id="浏览器阻塞"><a href="#浏览器阻塞" class="header-anchor">#</a> 浏览器阻塞</h2> <p>:::tip
同一时间对服务器的请求过多，将会造成浏览器阻塞。
浏览器默认对同一域下的资源，只保持一定的连接数，阻塞过多的连接,以提高访问速度和解决阻塞问题。
:::</p> <p>对于请求图片来说，有以下解决方法</p> <ul><li>使用雪碧图：把所有图片合成一张大图。</li> <li>延迟加载：只去请求可视区的图片。</li> <li>最后使用了延迟加载,对非可视区领域的图片延迟加载，优先加载可视区图片，减少图片的请求数。</li></ul> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">:src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>imageUrl<span class="token punctuation">&quot;</span></span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>img<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">//  方式一:延迟加载非可视区域</span>
<span class="token function">delayTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> windowHeight <span class="token operator">=</span> window<span class="token punctuation">.</span>innerHeight<span class="token punctuation">;</span>
  <span class="token keyword">let</span> imgTop <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$refs<span class="token punctuation">.</span>img<span class="token punctuation">.</span><span class="token function">getBoundingClientRect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>top<span class="token punctuation">;</span>
  <span class="token keyword">const</span> isDelay <span class="token operator">=</span> imgTop <span class="token operator">&gt;</span> windowHeight<span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>isDelay<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">2000</span> <span class="token operator">+</span> <span class="token number">3000</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">2000</span> <span class="token operator">+</span> <span class="token number">500</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">//  方法二:按顺序依次延迟加载</span>
<span class="token function">delayTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>params<span class="token punctuation">.</span>index<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">2000</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>params<span class="token punctuation">.</span>index <span class="token operator">*</span> <span class="token keyword">this</span><span class="token punctuation">.</span>params<span class="token punctuation">.</span>type <span class="token operator">*</span> <span class="token number">500</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">//  图片请求代码</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>delayTime<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></div></article></div></div> <div id="dark"><div class="btn"><i class="iconfont icon-light"></i></div></div> <!----> <div id="mouseChoose"><div class="btn"><i class="iconfont icon-chanpin" style="font-size:18px"></i></div> <!----> <div></div></div> <footer id="footer" data-v-d410213c><div class="footer-wrapper" data-v-d410213c>
    版权所有 ©️Timming官方
  </div></footer></div><div class="global-ui"></div></div>
    <script src="/timing-blog/assets/js/app.0e5bd67b.js" defer></script><script src="/timing-blog/assets/js/10.7a656b3b.js" defer></script><script src="/timing-blog/assets/js/12.0f90fce1.js" defer></script><script src="/timing-blog/assets/js/31.81328e1c.js" defer></script>
  </body>
</html>
